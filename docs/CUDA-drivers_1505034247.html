<!DOCTYPE html>
<html>
    <head>
        <title>Inteligencia Artificial - documentación central : CUDA drivers</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Inteligencia Artificial - documentación central</a></span>
                            </li>
                                                    <li>
                                <span><a href="1432617107.html">Inteligencia Artificial - Documentación central</a></span>
                            </li>
                                                    <li>
                                <span><a href="1462665217.html">Procesos de configuración</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Inteligencia Artificial - documentación central : CUDA drivers
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Daniel Tobon</span>, last modified on Nov 19, 2021
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p>En esta sección se explica el proceso de instalación de los drivers de CUDA para la correcta ejecución en GPU de un pipeline de Machine Learning, ya sea con Tensorflow o Pytorch.</p><h2 id="CUDAdrivers-1.InstalaciónNVIDIADriver">1. Instalación NVIDIA Driver</h2><p>Step 1: Elimine los controladores de Nvidia existentes, si los hay</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">sudo apt-get purge nvidia*</pre>
</div></div><p>Step 2: Agregar controladores gráficos PPA</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">sudo add-apt-repository ppa:graphics-drivers/ppa
sudo apt-get update</pre>
</div></div><p>Step 3: Buscar controladores disponibles</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">ubuntu-drivers devices</pre>
</div></div><p>Step 4: Instale el controlador con la mejor versión (la ultima versión)</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">sudo apt-get install nvidia-driver-460</pre>
</div></div><p><em><strong>Reinicie su computadora o máquina VM después de la instalación!!!</strong></em></p><p><em>Verificación</em></p><p>Escriba <code>nvidia-smi</code> para ver la información de la GPU y los procesos que utilizan la GPU de Nvidia</p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" loading="lazy" src="attachments/1505034247/1510113281.png" data-image-src="attachments/1505034247/1510113281.png" data-height="500" data-width="700" data-unresolved-comment-count="0" data-linked-resource-id="1510113281" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-20211119-183800.png" data-base-url="https://aituring.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="1505034247" data-linked-resource-container-version="4" data-media-id="192e3e55-72f5-4f34-94b8-7a267a6399c8" data-media-type="file"></span><h2 id="CUDAdrivers-2.InstalaciónCUDAToolkit">2. Instalación CUDA Toolkit</h2><p>Ir a <a href="https://developer.nvidia.com/cuda-downloads" data-card-appearance="inline" class="external-link" rel="nofollow">https://developer.nvidia.com/cuda-downloads</a>, seleccionar sistema operativo, arquitectura, distribución y finalmente versión. Para una versión en concreto de CUDA, ir al archive <a href="https://developer.nvidia.com/cuda-toolkit-archive" data-card-appearance="inline" class="external-link" rel="nofollow">https://developer.nvidia.com/cuda-toolkit-archive</a> </p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" loading="lazy" src="attachments/1505034247/1509294136.png" data-image-src="attachments/1505034247/1509294136.png" data-height="935" data-width="1846" data-unresolved-comment-count="0" data-linked-resource-id="1509294136" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="Screenshot from 2021-11-19 13-40-33.png" data-base-url="https://aituring.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="1505034247" data-linked-resource-container-version="4" data-media-id="89381ff7-0ce5-46b2-9381-663562b67439" data-media-type="file"></span><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">wget https://developer.download.nvidia.com/compute/cuda/11.5.0/local_installers/cuda_11.5.0_495.29.05_linux.run
sudo sh cuda_11.5.0_495.29.05_linux.run</pre>
</div></div><p><strong>Recuerde: ¡NO marque la opción de instalar el controlador (Driver)!</strong></p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" loading="lazy" src="attachments/1505034247/1509556238.png" data-image-src="attachments/1505034247/1509556238.png" data-height="476" data-width="700" data-unresolved-comment-count="0" data-linked-resource-id="1509556238" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-20211119-184512.png" data-base-url="https://aituring.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="1505034247" data-linked-resource-container-version="4" data-media-id="a6b318af-8f25-41c3-a010-2040e1f61ad7" data-media-type="file"></span><p>Después de la instalación, verá el resultado como se muestra a continuación.</p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" loading="lazy" src="attachments/1505034247/1510080515.png" data-image-src="attachments/1505034247/1510080515.png" data-height="451" data-width="700" data-unresolved-comment-count="0" data-linked-resource-id="1510080515" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-20211119-184557.png" data-base-url="https://aituring.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="1505034247" data-linked-resource-container-version="4" data-media-id="6bb75d7d-b0f8-41c9-accb-c28fa7879998" data-media-type="file"></span><h2 id="CUDAdrivers-3.ConfiguraciónvariablesdeentornoparaCUDA">3. Configuración variables de entorno para CUDA</h2><p>Para el sistema operativo Linux se recomienda agregar variables de entorno en <em><strong>/etc/environment</strong></em>.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">export PATH=/usr/local/cuda-11.2/bin${PATH:+:${PATH}}
export LD_LIBRARY_PATH=/usr/local/cuda-11.2/lib64${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}
export CUDA_HOME=/usr/local/cuda</pre>
</div></div><p>Ejemplo variables de entorno en /etc/environment :</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">PATH=&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/usr/local/cuda-11.2/bin:&quot;
LD_LIBRARY_PATH=&quot;/usr/local/cuda-11.2/lib64:/opt/cuda/lib64:&quot;
CUDA_HOME=&quot;/usr/local/cuda:&quot;</pre>
</div></div><h2 id="CUDAdrivers-3.InstalaciónCuDNN">3. Instalación CuDNN</h2><p>Ir al archive de NVIDIA <a href="https://developer.nvidia.com/rdp/cudnn-archive" data-card-appearance="inline" class="external-link" rel="nofollow">https://developer.nvidia.com/rdp/cudnn-archive</a> y descargue la versión correspondiente. Debe tener o crear una cuenta de desarrollador en NVIDIA antes de continuar, de forma gratuita.</p><p>Descomprima el archivo manualmente o utilizando una linea de comando:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">tar -zvxf cudnn-11.2-linux-x64-v8.1.0.77.tgz</pre>
</div></div><p>Copie los archivos extraidos en la instalación de CUDA ya sea con la opción 1 o con la opción 2.</p><p><strong>Opción 1:</strong></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">#copy the files in cuda toolkit directory 
sudo cp cuda/include/cudnn.h /usr/local/cuda/include
sudo cp cuda/lib64/libcudnn* /usr/local/cuda/lib64
sudo chmod a+r /usr/local/cuda/include/cudnn.h /usr/local/cuda/lib64/libcudnn*</pre>
</div></div><p><strong>Opción 2:</strong></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">cd xxx/cuda/include
sudo cp *.h /usr/local/cuda/include/
# replace xxx with your own path</pre>
</div></div><p>Finalmente, restablezca los permisos de lectura y escritura del archivo cudnn.h.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">sudo chmod a+r /usr/local/cuda/include/cudnn.h</pre>
</div></div><p>Para verificar la instalación, ingrese en una consola <code>nvidia-smi</code> y<code> nvcc -V</code>.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">nvidia-smi
nvcc -V</pre>
</div></div><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" loading="lazy" src="attachments/1505034247/1509359657.png" data-image-src="attachments/1505034247/1509359657.png" data-height="253" data-width="700" data-unresolved-comment-count="0" data-linked-resource-id="1509359657" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-20211119-185332.png" data-base-url="https://aituring.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="1505034247" data-linked-resource-container-version="4" data-media-id="a257ca9a-84c0-4195-9e65-52383ae6db27" data-media-type="file"></span><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" loading="lazy" src="attachments/1505034247/1510178819.png" data-image-src="attachments/1505034247/1510178819.png" data-height="170" data-width="700" data-unresolved-comment-count="0" data-linked-resource-id="1510178819" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-20211119-185339.png" data-base-url="https://aituring.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="1505034247" data-linked-resource-container-version="4" data-media-id="9c62096f-3f3c-4a8e-b42f-0731643ec4a3" data-media-type="file"></span><h2 id="CUDAdrivers-4.[Opcional]NVIDIAContainerToolkit">4. [Opcional] NVIDIA Container Toolkit</h2><p>NVIDIA Container Toolkit permite a los usuarios crear y ejecutar contenedores acelerados por GPU. El kit de herramientas incluye una biblioteca de tiempo de ejecución de contenedores y utilidades para configurar automáticamente los contenedores para aprovechar las GPU de NVIDIA.</p><p>Antes de comenzar, asegúrese de haber instalado el controlador NVIDIA para su distribución de Linux. La forma recomendada de instalar controladores es usar el administrador de paquetes para su distribución, pero también hay otros mecanismos de instalación disponibles (por ejemplo, descargando instaladores .run de Descargas de controladores de NVIDIA).</p><h5 id="CUDAdrivers-SettingupDocker¶">Setting up Docker<a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html#setting-up-docker" class="external-link" rel="nofollow">¶</a></h5><p>Docker-CE on Ubuntu can be setup using Docker’s official convenience script:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">curl https://get.docker.com | sh \
  &amp;&amp; sudo systemctl --now enable docker</pre>
</div></div><p>See also</p><p>Follow the official <a href="https://docs.docker.com/engine/install/ubuntu/" class="external-link" rel="nofollow">instructions</a> for more details and <a href="https://docs.docker.com/engine/install/linux-postinstall/" class="external-link" rel="nofollow">post-install actions</a>.</p><h5 id="CUDAdrivers-SettingupNVIDIAContainerToolkit¶">Setting up NVIDIA Container Toolkit<a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html#setting-up-nvidia-container-toolkit" class="external-link" rel="nofollow">¶</a></h5><p>Setup the <code>stable</code> repository and the GPG key:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">distribution=$(. /etc/os-release;echo $ID$VERSION_ID) \
   &amp;&amp; curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add - \
   &amp;&amp; curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | sudo tee /etc/apt/sources.list.d/nvidia-docker.list</pre>
</div></div><p>Note</p><p>To get access to <code>experimental</code> features such as <a href="https://docs.nvidia.com/cuda/wsl-user-guide/index.html" class="external-link" rel="nofollow">CUDA on WSL</a> or the new <a href="https://docs.nvidia.com/datacenter/tesla/mig-user-guide/index.html" class="external-link" rel="nofollow">MIG capability</a> on A100, you may want to add the <code>experimental</code> branch to the repository listing:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">curl -s -L https://nvidia.github.io/nvidia-container-runtime/experimental/$distribution/nvidia-container-runtime.list | sudo tee /etc/apt/sources.list.d/nvidia-container-runtime.list</pre>
</div></div><p>Install the <code>nvidia-docker2</code> package (and dependencies) after updating the package listing:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">sudo apt-get update
sudo apt-get install -y nvidia-docker2
Restart the Docker daemon to complete the installation after setting the default runtime:</pre>
</div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">sudo systemctl restart docker
At this point, a working setup can be tested by running a base CUDA container:</pre>
</div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">sudo docker run --rm --gpus all nvidia/cuda:11.0-base nvidia-smi</pre>
</div></div><p>This should result in a console output shown below:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">+-----------------------------------------------------------------------------+
| NVIDIA-SMI 450.51.06    Driver Version: 450.51.06    CUDA Version: 11.0     |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|                               |                      |               MIG M. |
|===============================+======================+======================|
|   0  Tesla T4            On   | 00000000:00:1E.0 Off |                    0 |
| N/A   34C    P8     9W /  70W |      0MiB / 15109MiB |      0%      Default |
|                               |                      |                  N/A |
+-------------------------------+----------------------+----------------------+
+-----------------------------------------------------------------------------+
| Processes:                                                                  |
|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |
|        ID   ID                                                   Usage      |
|=============================================================================|
|  No running processes found                                                 |
+-----------------------------------------------------------------------------+
</pre>
</div></div><p /><h2 id="CUDAdrivers-Referencias">Referencias</h2><p><a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html" data-card-appearance="inline" class="external-link" rel="nofollow">https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html</a> </p><p><a href="https://medium.com/analytics-vidhya/install-cuda-11-2-cudnn-8-1-0-and-python-3-9-on-rtx3090-for-deep-learning-fcf96c95f7a1" data-card-appearance="inline" class="external-link" rel="nofollow">https://medium.com/analytics-vidhya/install-cuda-11-2-cudnn-8-1-0-and-python-3-9-on-rtx3090-for-deep-learning-fcf96c95f7a1</a> </p><p><a href="https://developer.nvidia.com/rdp/cudnn-archive" data-card-appearance="inline" class="external-link" rel="nofollow">https://developer.nvidia.com/rdp/cudnn-archive</a> </p><p><a href="https://developer.nvidia.com/cuda-toolkit-archive" data-card-appearance="inline" class="external-link" rel="nofollow">https://developer.nvidia.com/cuda-toolkit-archive</a> </p><p><a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html" data-card-appearance="inline" class="external-link" rel="nofollow">https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html</a> </p><p /><p />
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1505034247/1510113281.png">image-20211119-183800.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1505034247/1509687306.png">image-20211119-183923.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1505034247/1509392423.png">Screenshot from 2021-11-19 13-40-33.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1505034247/1509294136.png">Screenshot from 2021-11-19 13-40-33.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1505034247/1509556238.png">image-20211119-184512.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1505034247/1510080515.png">image-20211119-184557.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1505034247/1509359657.png">image-20211119-185332.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1505034247/1510178819.png">image-20211119-185339.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Dec 06, 2021 20:42</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
